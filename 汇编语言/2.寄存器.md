## 2寄存器

一个典型的CPU由运算器、控制器、寄存器等期间组成，这些器件靠内部总线相连

- 运算器进行信息处理
- 寄存器进行信息处理
- 控制器控制各种器件进行工作
- 内部总线连接各种器件，在他们之间进行数据的传送

8086CPU有14个寄存器：AX、BX、CX、DX、SI、DI、SP、BP、IP、CS、SS、DS、ES、PSW通用寄存器一般有8个

### 2.1通用寄存器

8086CPU所有寄存器都是16位的，可以存放2个字节(一个字WORD)。：AX、BX、CX、DX通常存放一般性数据，称为通用寄存器

以AX为例，逻辑结构如下15，14，13...0，AX可以分为AH(高八位)和AL(低八位)独立使用,其他同理

数据18，二进制表示10010，在AX中存储为0000000000010010

16位寄存器做多能存储的值为2<sup>16</sup>-1

### 2.2字在寄存器中的存储

出于兼容性考虑，8086CPU可以一次性处理一下2中尺寸的数据，关于数制为了方便表示，采用16进制(4个二进制位)。
- 字节：byte(8bit)
- 字：word(2byte)


### 2.3几条汇编指令

汇编语言的指令是不区分大小写的

|汇编指令|控制CPU完成的操作|高级语言的语法描述|
|----|----|----|
|MOV AX,18|将18送入寄存器AX|AX=18|
|MOV AH,78|将78送入寄存器AH|AH=78|
|add AX,BX|将AX和BX的数值相加，结果存在AX中|AX=AX+BX|


问题2.2

|程序段中指令|执行后AX中的数据|执行后BX中的数据|
|----|----|----|
|略|略|略|
|ADD AL,85H|00C5H|4026H|
|ADD AL,93H|?0058H|4026H|

注意AL作为8位寄存器只能存放2位16进制的数据，进位1会丢失(并不会真的丢弃)

检测点2.1

(1)写出每条指令执行后相关寄存器的值

    mov ax,62627        AX=f4A3
    mov ah,31H          AX=31A3
    mov al,23H          AX=3123
    add ax,ax           AX=6246
    mov bx,826CH        BX=826CH
    mov cx,ax           CX=6246
    mov ax,bx           AX=826CH
    add ax,bx           AX=04D8
    mov al,bh           AX=0482
    mov ah,bl           AX=6C82
    add ah,ah           AX=D882
    add al,6            AX=D888
    add al,al           AX=D810
    mov ax,cx           AX=6246

(2)只能使用目前学过的汇编指令，最多使用4条指令，计算2的4次方

    mov ax,2
    add ax,ax
    add ax,ax
    add ax,ax

### 2.4物理地址

CPU访问内存单元时要给出内存单元的地址。所有的内存单元构成的存储空间是一个一维的线性空间，我们将这个唯一的地址称为物理地址

### 2.5 16位结构的CPU

概括地讲，16位结构描述了一个CPU具有以下几方面特征

- 运算器一次最多可以处理16位的数据
- 寄存器的最大宽度为16位
- 寄存器和运算器之间的通路为16位

### 2.6 8086CPU给出物理地址的方法

- 8086有20位的地址总线，可传送20位的地址，寻址能力为1M

- 8086内部为16位结构，只能传送16位的地址，表现出的寻址能力却只有64K

8086CPU采用一种在内部用2个16位地址合成的方法来形成一个20位的物理地址

当8086CPU读写内存时：

1. CPU中的而相关部件提供2个16为的地址，一个称为段地址，另一个称为偏移地址
2. 段地址和偏移地址通过内部总线送入一个称为地址加法器的部件
3. 地址加法器将两个16位地址合称为一个20位的物理地址
4. 地址加法器通过内部总线将20位的物理地址送入输入输出控制电路
5. 输入输出控制电路将20位物理地址送上地址总线
6. 20位物理地址被地址总线传送到存储器

物理地址 = 段地址*16(相当于数据左移4位，可以看做是基础地址)+偏移地址

实际上段地址和偏移地址并不是唯一的

### 2.8段的概念

内存实际上并没有被分段，只是用2个16位地址形成了一个20位地址

检测点2.2

1. 给定一个段地址0001H，仅通过变化便宜寻址，CPU寻址范围为0到FFFFH

2. 有一数据存放在内存20000H，给定段地址SA，若想用便宜地址旬到此单元，SA最小为1001H，最大为2000H


### 2.9段寄存器

段寄存器就是提供段地址的，8086CPU有4个段寄存器CS(code segment)、DS(data segment)、SS(stack segment)、ES(extra segment)

### 2.10 CS和IP

CPU两个最重要的段寄存器，CS是代码段寄存器，IP是指令指针寄存器

8086CPU工作过程简要描述

1. 从CS:IP指向的内存单元读取指令，读取的指令进入指令缓冲器

2. IP=IP+所读取指令的长度，从而指向吓一跳指令

3. 执行指令，转到步骤1，重复这个过程

8086CPU加点或复位后CS:IP被设置为FFFF0H

### 2.11修改CS、IP的指令

修改IP的内容：

转移指令 jmp 段地址：偏移地址

jmp 3:0B16   =>    00B46

jmp ax  => mov ip,ax

### 2.12代码段

可以将长度为N(N<=64KB)的一组代码存在一个连续、起始地址为16的倍数的内存单元中，如123BH

### 实验一

现在的计算机基本是WIN10系统，所以这里需要下载几个软件

- [DOSBOX](https://dosbox.en.softonic.com)

DEBUG指令

1. R查看修改CPU寄存器内容

    r

    r ax 

    r ax 
    
    值
2. D查看内从中的内容

    d 

    d cs:ip [end]

3. E修改内存中的内容

4. U将内存中的机器指令翻译成汇编指令

5. T命令执行一条指令

6. A命令以汇编指令的格式写一条机器指令

实验 

查找PC机主板上的ROM的一个生产时期，在FFF00h~FFFFH并试图概念他
的fff0:0 ff

向内存从B8100H写入数据
-e B810:0000 01 01 02 02 03 03 04 04